<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	
<!-- Mirrored from wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 12 Mar 2018 13:30:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.1" />
		<meta name="robots" content="noindex,nofollow" />
		<meta name="keywords" content="Map store locator,Users" />
		<link rel="next" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator" />
		<link rel="shortcut icon" href="http://wwwhomes.doc.ic.ac.uk/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/opensearch_desc.php" title="Rashed Karim Wiki (en)" />
		<link rel="alternate" type="application/rss+xml" title="Rashed Karim Wiki RSS Feed" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="Rashed Karim Wiki Atom Feed" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>View source - Rashed Karim Wiki</title>
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/shared.css?207" type="text/css" media="screen" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/commonPrint.css?207" type="text/css" media="print" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/monobook/main.css?207" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/~rkarim/mediawiki/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/~rkarim/mediawiki/skins";
		var wgArticlePath = "http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=$1";
		var wgScriptPath = "/~rkarim/mediawiki";
		var wgScript = "http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://wwwhomes.doc.ic.ac.uk/";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Map_store_locator";
		var wgTitle = "Map store locator";
		var wgAction = "edit";
		var wgArticleId = "633";
		var wgIsArticle = false;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 3842;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/wikibits.js?207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/edit.js?207"></script>
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/ajax.js?207"></script>
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Map_store_locator skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">View source</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Rashed Karim Wiki</h3>
			<div id="contentSub">for <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator" title="Map store locator">Map store locator</a></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">The action you have requested is limited to users in the group: <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Rashed Karim Wiki:Users (page does not exist)">Users</a>.</div>
<p>You can view and copy the source of this page:
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="readonly">== The plugin == 

The plugin that was included to enable store locator like map search capabilities within the site is the [https://github.com/bjorn2404/jQuery-Store-Locator-Plugin JQuery store locator plugin]

== Integration issues == 

The plugin did not work out of the box. I had to make a few modifications to it. Here are the following changes 

1. '''Injecting Drop-down input data before form submission''' 

In the query.storelocator.js file under folder ''/javascript/other_libraries/jQuery-Store-Locator-Plugin/assets/js/plugins/storeLocator'' 

In '''Line 570''' under function '''_getData()''', the following changes were made to retrieve the subject, subject level and school from the drop-down: 
&lt;pre&gt;
	var subject_id = $('#select_subject_list').val(); 
	var subject_level_id = $('#select_subject_level_list').val();
	var school_id = $('#select_school_list').val();
&lt;/pre&gt;

And '''Line 590''': 
&lt;pre&gt;
subject_id': subject_id, 
'subject_level_id': subject_level_id, 
'school_id': school_id
&lt;/pre&gt;


2. '''Changes to templates for Info description and location list descriptions''' 

The Info description is the speech bubble that appears when a map marker is clicked. The location list description is the list of search results to the right of the map. 

Both the style CSS can be altered by editing the files under ''/javascript/other_libraries/jQuery-Store-Locator-Plugin/assets/js/plugins/storeLocator/templates'' 

The '''info-description.html''' was changed to this: 
&lt;pre&gt;
{{#location}}
&lt;div class=&quot;loc-name&quot;&gt;{{name}}&lt;/div&gt;
&lt;div&gt;{{postal}}&lt;/div&gt;
&lt;div&gt;{{hours1}}&lt;/div&gt;
&lt;div&gt;{{hours2}}&lt;/div&gt;
&lt;div&gt;{{hours3}}&lt;/div&gt;
&lt;div&gt;{{phone}}&lt;/div&gt;
&lt;div&gt;&lt;a onclick=&quot;return popitup('{{web}}')&quot; target=&quot;_blank&quot;&gt;View tutor profile&lt;/a&gt;&lt;/div&gt;
{{/location}}
&lt;/pre&gt;

and the '''location-list-description.html''' was changed to this: 
&lt;pre&gt;
{{#location}}
&lt;li data-markerid=&quot;{{markerid}}&quot;&gt;
	&lt;div class=&quot;list-label&quot;&gt;{{marker}}&lt;/div&gt;
	&lt;div class=&quot;list-details&quot;&gt;
		&lt;div class=&quot;list-content&quot;&gt;
			&lt;div class=&quot;loc-name&quot;&gt;{{name}}&lt;/div&gt;
			&lt;div class=&quot;loc-addr&quot;&gt;{{postal}}&lt;/div&gt; 
			&lt;div class=&quot;loc-phone&quot;&gt;{{phone}}&lt;/div&gt;
			&lt;div class=&quot;loc-web&quot;&gt;&lt;a onclick=&quot;return popitup('{{web}}')&quot; target=&quot;_blank&quot;&gt;View tutor profile&lt;/a&gt;&lt;/div&gt;
			{{#if distance}}
				&lt;div class=&quot;loc-dist&quot;&gt;{{distance}} {{length}}&lt;/div&gt;
				&lt;div class=&quot;loc-directions&quot;&gt;&lt;a href=&quot;https://maps.google.com/maps?saddr={{origin}}&amp;amp;daddr={{address}} {{address2}} {{city}}, {{state}} {{postal}}&quot; target=&quot;_blank&quot;&gt;Directions&lt;/a&gt;&lt;/div&gt;
			{{/if}}
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/li&gt;
{{/location}}
&lt;/pre&gt;


== How the plugin works on the site == 

Here are the sequence of events: 

1. The user types a postcode or selects a client. On selecting a client, the postcode is fetched via an Ajax call. 

2. The user then selects a subject or school. Subject levels can be left blanked, which passes a 0 value to the PHP processor, and this is interpreted as a -1 to indicate search all levels in the function ''Subject::getTutorsWhoCanTeachSubjectAtLevelReturnPostcode()'' 

3. On pressing the submit button for the form, the postcode is geo-coded internally by the plugin and a GET request is sent to a URL, expecting JSON data in return response. This shown [https://www.bjornblog.com/web/jquery-store-locator-plugin as an example in their blog]

Here is the sample data in the GET request sent: ''generated using print_r($_GET, true)''
&lt;pre&gt;
(
    [origLat] =&gt; 51.497263
    [origLng] =&gt; -0.14865529999997307
    [origAddress] =&gt; SW1W 9DA
    [formattedAddress] =&gt; Eaton Square, Belgravia, London SW1W 9DA, UK
    [boundsNorthEast] =&gt; {&quot;lat&quot;:51.4978687,&quot;lng&quot;:-0.14823300000000472}
    [boundsSouthWest] =&gt; {&quot;lat&quot;:51.4969001,&quot;lng&quot;:-0.14970679999998993}
    [subject_id] =&gt; 57
    [subject_level_id] =&gt; 0
    [school_id] =&gt; 0
)
&lt;/pre&gt;

4. The data from the GET request is read and processed by the ''Subjects::getTutorsWhoCanTeachSubjectAtLevelReturnPostcode()'' function. The search results are put into an array and converted into JSON which is constructed in '''Line 136''' of ''admin_portal_controllers/maps_search_controller.php''. The return JSON looks like this: 

&lt;pre&gt;
{
  {&quot;id&quot;:&quot;898&quot;, &quot;name&quot;=&gt;&quot;Tutor name&quot;, &quot;lat&quot;=&gt;98.121212, &quot;lng&quot;=&gt;112.1212, &quot;address&quot;=&gt;&quot;tutor address&quot;, /* There are other fields that have been omitted, see line 136*/ }, 
  {...}
} 
&lt;/pre&gt;

5. Once the JSON is passed back to the plugin, it renders the data to the map and displays as a list. All of this works as a blackbox. 

6. It is important to note that there are '''TWO''' callbacks called before and after the map search. These are specified in-line in the definition of the plugin itself under maps_search2.php. See '''Line 426-427''': 
&lt;pre&gt;
            'callbackBeforeSend': function() { this.clearMarkers(); waitingDialog.show('Searching database',{progressType: 'success'});   },
            'callbackSuccess': function() { waitingDialog.hide(); $('#bh-sl-address').val(''); $('#select_client_list').val(0); }
&lt;/pre&gt;</textarea><div class='templatesUsed'>

</div>
<p>Return to <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator" title="Map store locator">Map store locator</a>.</p>
<div class="printfooter">
Retrieved from "<a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator">http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Talk:Map_store_locator&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource" class="selected"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=User:159.92.151.128" title="The user page for the ip you&#039;re editing as [.]" accesskey="." class="new">159.92.151.128</a></li>
				<li id="pt-anontalk"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=User_talk:159.92.151.128" title="Discussion about edits from this IP address [n]" accesskey="n" class="new">Talk for this IP</a></li>
				<li id="pt-anonlogin"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:UserLogin&amp;returnto=Map_store_locator" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/images/myWikiLogo.gif);" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Research_Wiki" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Research_Wiki">Main Page</a></li>
				<li id="n-Home"><a href="http://www.doc.ic.ac.uk/~rkarim/">Home</a></li>
				<li id="n-currentevents"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search Rashed Karim Wiki [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:WhatLinksHere/Map_store_locator" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChangesLinked/Map_store_locator" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
					<li id="privacy"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Privacy_policy" title="Rashed Karim Wiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:About" title="Rashed Karim Wiki:About">About Rashed Karim Wiki</a></li>
					<li id="disclaimer"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:General_disclaimer" title="Rashed Karim Wiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.495 secs. --></body>
<!-- Mirrored from wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Map_store_locator&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 12 Mar 2018 13:30:26 GMT -->
</html>
