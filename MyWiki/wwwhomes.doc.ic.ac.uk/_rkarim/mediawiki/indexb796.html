<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	
<!-- Mirrored from wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 12 Mar 2018 13:30:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.1" />
		<meta name="robots" content="noindex,nofollow" />
		<meta name="keywords" content="Elastic search,Users" />
		<link rel="next" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search" />
		<link rel="shortcut icon" href="http://wwwhomes.doc.ic.ac.uk/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/opensearch_desc.php" title="Rashed Karim Wiki (en)" />
		<link rel="alternate" type="application/rss+xml" title="Rashed Karim Wiki RSS Feed" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="Rashed Karim Wiki Atom Feed" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>View source - Rashed Karim Wiki</title>
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/shared.css?207" type="text/css" media="screen" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/commonPrint.css?207" type="text/css" media="print" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/monobook/main.css?207" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/~rkarim/mediawiki/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/~rkarim/mediawiki/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/~rkarim/mediawiki/skins";
		var wgArticlePath = "http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=$1";
		var wgScriptPath = "/~rkarim/mediawiki";
		var wgScript = "http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://wwwhomes.doc.ic.ac.uk/";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Elastic_search";
		var wgTitle = "Elastic search";
		var wgAction = "edit";
		var wgArticleId = "578";
		var wgIsArticle = false;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 3785;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/wikibits.js?207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/edit.js?207"></script>
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/ajax.js?207"></script>
		<script type="text/javascript" src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Elastic_search skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">View source</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Rashed Karim Wiki</h3>
			<div id="contentSub">for <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search" title="Elastic search">Elastic search</a></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">The action you have requested is limited to users in the group: <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Rashed Karim Wiki:Users (page does not exist)">Users</a>.</div>
<p>You can view and copy the source of this page:
</p><textarea id="wpTextbox1" name="wpTextbox1" cols="80" rows="25" readonly="readonly">== Creating an index == 
There are currently two indexes: '''tutor_cv''' and '''tutor_cv_new_reg''' 

Create a new index and its mapping, this uses the English analyzer below. The example below is for tutor_cv. A separate index should be created for tutor_cv_new_reg

The index should be created locally using Google Chrome's SENSE. See below for details 

&lt;pre&gt;
PUT /tutor_cv
{
    &quot;mappings&quot; : {
      &quot;wordpdf&quot; : {
        &quot;properties&quot; : {
          &quot;content&quot; : {
            &quot;type&quot; : &quot;attachment&quot;,
            &quot;fields&quot; : {
              &quot;content&quot; : {
                &quot;type&quot; : &quot;string&quot;,
                &quot;store&quot; : true,
                &quot;term_vector&quot; : &quot;with_positions_offsets&quot;,
                &quot;analyzer&quot;:&quot;english&quot;
              },
              &quot;author&quot; : {
                &quot;type&quot; : &quot;string&quot;
              },
              &quot;title&quot; : {
                &quot;type&quot; : &quot;string&quot;
              },
              &quot;name&quot; : {
                &quot;type&quot; : &quot;string&quot;
              },
              &quot;date&quot; : {
                &quot;type&quot; : &quot;date&quot;,
                &quot;format&quot; : &quot;strict_date_optional_time||epoch_millis&quot;
              },
              &quot;keywords&quot; : {
                &quot;type&quot; : &quot;string&quot;
              },
              &quot;content_type&quot; : {
                &quot;type&quot; : &quot;string&quot;
              },
              &quot;content_length&quot; : {
                &quot;type&quot; : &quot;integer&quot;
              },
              &quot;language&quot; : {
                &quot;type&quot; : &quot;string&quot;
              }
            }
          },
          &quot;url&quot; : {
            &quot;type&quot; : &quot;string&quot;
          }
        }
      }
    }
}

&lt;/pre&gt;

For '''Tutor_notes''' this is how the index can be created:
&lt;pre&gt;
PUT tutor_notes 
{
  &quot;mappings&quot;: {
    &quot;tutor_note_type&quot; : {
    &quot;properties&quot; : {
      &quot;tutor_note&quot; : {
        &quot;properties&quot; : {
          &quot;note&quot; : {
            &quot;type&quot; : &quot;string&quot;, 
            &quot;analyzer&quot;:&quot;english&quot;
          }, 
          &quot;id&quot; : {
              &quot;type&quot; : &quot;integer&quot;
          }
        }
      }
    }
  }
  }
}
&lt;/pre&gt;

== Checking the mapping == 
For mapper attachments: 

&lt;pre&gt;
GET /tutor_cv/wordpdf/_mapping
&lt;/pre&gt;

== Get stats ==

On '''Tutor CV''' 

&lt;pre&gt;
GET /tutor_cv/_stats
&lt;/pre&gt;


On '''Tutor notes'''

&lt;pre&gt;
GET /tutor_notes/_stats
&lt;/pre&gt;


== Deleting an index ==

This command will delete an index 
&lt;pre&gt;
DELETE /tutor_cv_new_reg
&lt;/pre&gt;

== Searching an index == 

Quick dirty search:
&lt;pre&gt;
POST /index_name/type_name/_search?q=content:test
&lt;/pre&gt;

Simple search:
&lt;pre&gt;
POST /dst/wordpdf/_search
{
    &quot;query&quot;: {
        
        &quot;match&quot;: {
           &quot;content.content&quot;: &quot;physics&quot;
        }
    }
}
&lt;/pre&gt;

Using conjunctive queries: 
Note the highlight entry will highlight the search terms 
&lt;pre&gt;
POST /tutor_cv/wordpdf/_search
{
   &quot;fields&quot;: [
       &quot;url&quot;
       ],
   &quot;query&quot;: {
      &quot;query_string&quot;: {
         &quot;default_field&quot;: &quot;content.content&quot;,
         &quot;query&quot;: &quot;english AND math*&quot;
      }
   },
   &quot;highlight&quot;: {
      &quot;fields&quot;: {
         &quot;content.content&quot;: {}
      }
   }
}
&lt;/pre&gt;

== Using SENSE == 
Google Chrome's SENSE toolbox can be used to issue CURL commands to the cluster. 

== Rebuilding the index == 

'''Tutor CVs''' 

The index can be built on the local machine. 

For testing search,  as the Elastic-PHP library needs HTTPS certification for establishing a connection with the cluster, otherwise you get a Node not alive error in the PHP logs. 

Use the script under /elastic/build_index.php 

* '''Step1:''' Delete the existing indices by logging to Seachly dashboard. Create new indices with PUT commands above. It may be possible to simply build by over-writing on the indices and Elastic may be capable of recognising and ignoring duplicates. 

* '''Step2:''' Download the /tutor_cv to your local machine under a folder such as /tutor_cv2 (Prevent clash) 

* '''Step3:''' Increase the max limit of files that can be open, do this on the SSH session. Only valid for an SSH session window  
&lt;pre&gt;
ulimit -S -n 2048
&lt;/pre&gt;

* '''Step4''': Configure the the script under /elastic/build_index.php and run it from command-line: 
&lt;pre&gt;
php build_index.php 
&lt;/pre&gt; 

* '''Step5''': To check that the index was built properly, the report is written to a text file: '''index_report_at_1455104911.txt'''. Also check the Index stats using Google Chrome's SENSE: 
&lt;pre&gt;
GET /tutor_cv/_stats
&lt;/pre&gt;

'''Tutor Notes'''
 
THIS MUST BE RUN ON SERVER. 

It is straightforward to re-build tutor note index, just invoke on server, as running it on local machine fetches notes only from local database: 
&lt;pre&gt;
http://dst/elastic/build_index_for_notes.php
&lt;/pre&gt;

And check on the index_report.txt in /elastic folder to keep track of which notes were inserted


== Code changes with Searchly == 
* To make the switch from Box to Searchly, a change was needed in the ElasticIndex.php file where the port number for HTTPS had to be specified (443): 
&lt;pre&gt;
$hosts= ['https://site:our-access-key@bifur-eu-west-1.searchly.com:443'];
&lt;/pre&gt;

* Also, the php version had switched automatically with SGround back to 5.3. For the code to run, the PHP version must be 5.4. There are many new PHP array notations used throughout my code and the Elastic API. So not at all compatible with PHP 5.3.</textarea><div class='templatesUsed'>

</div>
<p>Return to <a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search" title="Elastic search">Elastic search</a>.</p>
<div class="printfooter">
Retrieved from "<a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search">http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Talk:Elastic_search&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource" class="selected"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=User:159.92.151.128" title="The user page for the ip you&#039;re editing as [.]" accesskey="." class="new">159.92.151.128</a></li>
				<li id="pt-anontalk"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=User_talk:159.92.151.128" title="Discussion about edits from this IP address [n]" accesskey="n" class="new">Talk for this IP</a></li>
				<li id="pt-anonlogin"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:UserLogin&amp;returnto=Elastic_search" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/images/myWikiLogo.gif);" href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Research_Wiki" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Research_Wiki">Main Page</a></li>
				<li id="n-Home"><a href="http://www.doc.ic.ac.uk/~rkarim/">Home</a></li>
				<li id="n-currentevents"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search Rashed Karim Wiki [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:WhatLinksHere/Elastic_search" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:RecentChangesLinked/Elastic_search" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
					<li id="privacy"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:Privacy_policy" title="Rashed Karim Wiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:About" title="Rashed Karim Wiki:About">About Rashed Karim Wiki</a></li>
					<li id="disclaimer"><a href="http://wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Rashed_Karim_Wiki:General_disclaimer" title="Rashed Karim Wiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.447 secs. --></body>
<!-- Mirrored from wwwhomes.doc.ic.ac.uk/~rkarim/mediawiki/index.php?title=Elastic_search&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 12 Mar 2018 13:30:29 GMT -->
</html>
